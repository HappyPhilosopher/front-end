<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <link rel="stylesheet" href="./index.css" />
    <link rel="icon" href="#" />
  </head>

  <body>
    <div id="box">
      <div id="content">
        目前主要针对的是javascript培训，同时还提供了css教程、javascript视频、js特效等，最新推出了外地学员们喜欢的javascript网络课程服务，同时还为处于javascript入门阶段的朋友录制了大量javascript视频，其中涉及了大量javascript基础知识，希望妙味课堂推出的javascript网络培训课程能带给大家更多惊喜。目前主要针对的是javascript培训，同时还提供了css教程、javascript视频、js特效等，最新推出了外地学员们喜欢的javascript网络课程服务，同时还为处于javascript入门阶段的朋友录制了大量javascript视频，其中涉及了大量javascript基础知识，希望妙味课堂推出的javascript网络培训课程能带给大家更多惊喜。目前主要针对的是javascript培训，
      </div>
      <div id="open">
        <a href="javascript:;">展开</a>
        <ul style="display: none;">
          <li><a href="javascript:;">查找</a></li>
          <li><a href="javascript:;">替换</a></li>
        </ul>
      </div>
      <div id="fun" style="display: none;">
        <div class="btns">
          <a href="javascript:;" class="active">查找</a>
          <a href="javascript:;">替换</a>
        </div>

        <div id="search" style="display: block;">
          <input type="text" />
          <input type="button" value="" />
        </div>
        <div id="replace">
          <input type="text" />
          <input type="text" />
          <input type="button" value="" />
        </div>
      </div>
    </div>

    <script>
      (function() {
        'use strict';

        /**
         * 遍历元素对象，点击后打开/隐藏操作界面
         * @param {Object} el DOM 元素
         * @param {Number} index DOM 元素的索引
         */
        function handler(el, index) {
          el.addEventListener('click', function() {
            function showControlArea() {
              if (index === 0) {
                search.style.display = 'block';
                replace.style.display = 'none';
              } else {
                search.style.display = 'none';
                replace.style.display = 'block';
              }
            }

            fun.style.display = 'block';
            showControlArea();
          });
        }

        const openBtn = document.querySelector('#open');
        const content = document.querySelector('#content');
        const text = content.innerHTML;
        const fun = document.querySelector('#fun');
        const search = document.querySelector('#search');
        const replace = document.querySelector('#replace');
        const btns = fun.querySelector('.btns').children;
        const searchInputs = search.children;
        const replaceInputs = replace.children;

        openBtn.addEventListener('click', function() {
          this.lastElementChild.style.display = 'block';
        });

        Array.from(openBtn.querySelectorAll('ul a')).forEach(handler);
        Array.from(btns).forEach(handler);

        // 查找内容
        searchInputs[1].addEventListener('click', function() {
          const searchContent = searchInputs[0].value;
          const reg = new RegExp(searchContent, 'g');
          content.innerHTML = text.replace(
            reg,
            `<mark>${searchContent}</mark>`
          );
        });

        // 替换内容
        replaceInputs[2].addEventListener('click', function() {
          const originValue = replaceInputs[0].value;
          const replacedValue = replaceInputs[1].value;
          const reg = new RegExp(originValue, 'g');
          content.innerHTML = text.replace(reg, replacedValue);
        });
      })();
    </script>
  </body>
</html>
